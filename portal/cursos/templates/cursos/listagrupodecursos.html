{% extends 'core/lista.html' %}
{% block content %}
    <div class="row padding-top-bottom">
        <div class="small-12 columns">
            <form id="formuladio" name="formulario" method="post" action="{% url 'guiadecursoportal' %}">{% csrf_token %}
            <table width="100%">
                <thead>
                <tr>
                    <th>
                        <label>Filtrar pela formação
                            <select id="filtroformacao" name="filtroformacao">
                                <option value="0">--------</option>
                                {% for f in formacao %}
                                    <option value="{{ f.formacao__id }}">{{ f.formacao__nome }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </th>
                    <th>
                        <label>Filtrar pelo Câmpus
                            <select id="filtrocampi" name="filtrocampi">
                                <option value="0">--------</option>
                            </select>
                        </label>
                    </th>
                    <th>
                        <label>Filtrar pelo curso
                            <select id="filtrocursos" name="filtrocursos">
                                <option value="0">--------</option>
                            </select>
                        </label>
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for g in grupo_cursos %}
                <tr>
                    <td>{{ g.formacao__nome }}</td>
                    <td>{{ g.campus__nome }}</td>
                    <td><a href="{% url 'listacursosdogrupo' g.campus__id g.grupo__id %}">{{ g.grupo__nome }}</a></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            </form>
        </div>
    </div>
    <hr />
{% endblock %}
{% block javascript %}
<script>
    $(document).ready(function(){
        $("#filtroformacao").change(function(){
{#            alert ("change event occured with value: " + document.getElementById("formacao").value);#}
            $.ajax({
                url:'/jsoncampi/' + $(this).val() + '/',
                type:'POST',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(json) {
                    var options = "<option value='0'>--------</option>";
                    $.each(json, function(key, value){
                        options += '<option value="' + key + '">' + value + '</option>';
                    });
                    $("#filtrocampi").html(options);
                },
                error: function(xhr,errmsg,err) {
                    alert(xhr.status + ": " + xhr.responseText);
                }
            });
            return false;
        });

        $("#filtrocampi").change(function(){
            $.ajax({
                url:'/jsoncursos/' + document.getElementById("formacao").value + '/' + $(this).val() + '/',
                type:'POST',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(json) {
                    var options = "<option value='0'>--------</option>";
                    $.each(json, function(key, value){
                        options += '<option value="' + key + '">' + value + '</option>';
                    });
                    $("#filtrocursos").html(options);
                },
                error: function(xhr,errmsg,err) {
                    alert(xhr.status + ": " + xhr.responseText);
                }
            });
            return false;
        });

    });
</script>
{% endblock %}