{% extends 'core/lista.html' %}
{% block content %}
    <div class="row padding-top-bottom">
        <div class="small-12 columns">
            <form id="formuladio" name="formulario" method="post">{% csrf_token %}
                <div class="row fundo-cinza padding-all">
                    <div class="small-4 large-4 columns">
                        <label>Filtrar pela formação
                            <select id="filtroformacao" name="filtroformacao">
                                <option value="0">--------</option>
                                {% for f in formacao %}
                                    <option value="{{ f.formacao__id }}">{{ f.formacao__nome }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </div>
                    <div class="small-4 large-4 columns">
                        <label>Filtrar pelo Câmpus
                            <select id="filtrocampi" name="filtrocampi">
                                <option value="0">--------</option>
                                {% for c in campi %}
                                    <option value="{{ c.campus__id }}">{{ c.campus__nome }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </div>
                    <div class="small-4 large-4 columns">
                        <label>Filtrar pelo curso
                            <select id="filtrocursos" name="filtrocursos">
                                <option value="0">--------</option>
                                {% for g in grupo_cursos %}
                                    <option value="{{ g.grupo__id }}">{{ g.grupo__nome }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </div>
                </div>
            </form>
        </div>
        <div class="small-12 columns">
            {% for g in grupo_cursos %}
                <div class="row {% cycle '' 'fundo-cinza'%} hover-cinza-medio padding-all">
                    <div class="small-4 large-4 columns">{{ g.formacao__nome }}</div>
                    <div class="small-4 large-4 columns">{{ g.campus__nome }}</div>
                    <div class="small-4 large-4 columns"><a href="{% url 'listacursosdogrupo' g.campus__id g.grupo__id %}">{{ g.grupo__nome }}</a></div>
                </div>
            {% endfor %}
        </div>
    </div>
    <hr />
{% endblock %}
{% block javascript %}
<script>
    $(document).ready(function(){
        $("#filtroformacao").change(function(){
{#            alert ("change event occured with value: " + document.getElementById("formacao").value);#}
            $.ajax({
                url:'/jsoncampi/' + $(this).val() + '/',
                type:'POST',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(json) {
                    var options = "<option value='0'>--------</option>";
                    $.each(json, function(key, value){
                        options += '<option value="' + key + '">' + value + '</option>';
                    });
                    $("#filtrocampi").html(options);
                },
                error: function(xhr,errmsg,err) {
                    alert(xhr.status + ": " + xhr.responseText);
                }
            });
            return false;
        });

        $("#filtrocampi").change(function(){
            $.ajax({
                url:'/jsoncursos/' + document.getElementById("filtroformacao").value + '/' + $(this).val() + '/',
                type:'POST',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(json) {
                    var options = "<option value='0'>--------</option>";
                    $.each(json, function(key, value){
                        options += '<option value="' + key + '">' + value + '</option>';
                    });
                    $("#filtrocursos").html(options);
                },
                error: function(xhr,errmsg,err) {
                    alert(xhr.status + ": " + xhr.responseText);
                }
            });
            return false;
        });

    });
</script>
{% endblock %}